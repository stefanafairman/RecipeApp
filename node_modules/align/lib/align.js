
module.exports = Align

function Align(cb) {
    this.queue = [];
    this.fns = [];

    if (cb) {
        this.fns.push(cb);
    };
};

Align.prototype.push = function() {
    var args = Array.prototype.slice.call(arguments);
    this.queue = this.queue.concat(args);
};

Align.prototype.init = function() {
    var queue = this.queue;
    var self = this;
    ;(function next(args) {
        if (!queue.length) {
            return self.done();
        };

        var item = queue.shift();
        args = args || [];
        args.push(function() {
            next(([]).slice.call(arguments));
        });
        return item.apply(self, args);
    })()
};

Align.prototype.done = function(fn) {
    if (fn) {
        return this.fns.push(fn);
    };

    var fns = this.fns;
    for (var i=0, len=fns.length;i<len;i++) {
        fns[i].call(this);
    };
};
